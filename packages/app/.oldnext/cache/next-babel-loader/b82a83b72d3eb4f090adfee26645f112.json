{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { API } from \"@koh/api-client\";\nimport { Role } from \"@koh/common\";\nimport { Col, Row } from \"antd\";\nimport { chunk, mean } from \"lodash\";\nimport moment from \"moment\";\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { StandardPageContainer } from \"../../../components/common/PageContainer\";\nimport NavBar from \"../../../components/Nav/NavBar\";\nimport SchedulePanel from \"../../../components/Schedule/SchedulePanel\";\nimport OpenQueueCard, { OpenQueueCardSkeleton } from \"../../../components/Today/OpenQueueCard\";\nimport PopularTimes from \"../../../components/Today/PopularTimes/PopularTimes\";\nimport ReleaseNotes from \"../../../components/Today/ReleaseNotes\";\nimport TACheckinButton from \"../../../components/Today/TACheckinButton\";\nimport WelcomeStudents from \"../../../components/Today/WelcomeStudents\";\nimport { useCourse } from \"../../../hooks/useCourse\";\nimport { useProfile } from \"../../../hooks/useProfile\";\nimport { useRoleInCourse } from \"../../../hooks/useRoleInCourse\";\nvar Container = styled.div.withConfig({\n  displayName: \"today__Container\",\n  componentId: \"guxhv1-0\"\n})([\"margin-top:32px;\"]);\nvar Title = styled.div.withConfig({\n  displayName: \"today__Title\",\n  componentId: \"guxhv1-1\"\n})([\"font-weight:500;font-size:30px;color:#212934;\"]);\n\nfunction arrayRotate(arr, count) {\n  var adjustedCount = (arr.length + count) % arr.length;\n  return arr.slice(adjustedCount, arr.length).concat(arr.slice(0, adjustedCount));\n}\n\nvar collapseHeatmap = function collapseHeatmap(heatmap) {\n  return chunk(heatmap, 4).map(function (hours) {\n    var filteredOfficeHours = hours.filter(function (v) {\n      return v !== -1;\n    });\n    return filteredOfficeHours.length > 0 ? mean(filteredOfficeHours) : -1;\n  });\n};\n\nexport default function Today() {\n  var _course$queues, _course$queues2;\n\n  var router = useRouter();\n  var cid = router.query.cid;\n  var profile = useProfile();\n  var role = useRoleInCourse(Number(cid));\n\n  var _useCourse = useCourse(Number(cid)),\n      course = _useCourse.course,\n      mutateCourse = _useCourse.mutateCourse;\n\n  var updateQueueNotes = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(queue, notes) {\n      var newQueues;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              newQueues = course && course.queues.map(function (q) {\n                return q.id === queue.id ? _objectSpread(_objectSpread({}, q), {}, {\n                  notes: notes\n                }) : q;\n              });\n              mutateCourse(_objectSpread(_objectSpread({}, course), {}, {\n                queues: newQueues\n              }), false);\n              _context.next = 4;\n              return API.queues.update(queue.id, {\n                notes: notes,\n                allowQuestions: queue.allowQuestions\n              });\n\n            case 4:\n              mutateCourse();\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function updateQueueNotes(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var queueCheckedIn = course === null || course === void 0 ? void 0 : course.queues.find(function (queue) {\n    return queue.staffList.find(function (staff) {\n      return staff.id === profile.id;\n    });\n  });\n  return __jsx(StandardPageContainer, null, __jsx(Head, null, __jsx(\"title\", null, course === null || course === void 0 ? void 0 : course.name, \" | Khoury Office Hours\")), __jsx(ReleaseNotes, null), __jsx(WelcomeStudents, null), __jsx(NavBar, {\n    courseId: Number(cid)\n  }), __jsx(Container, null, __jsx(Row, {\n    gutter: 64\n  }, __jsx(Col, {\n    md: 12,\n    xs: 24\n  }, __jsx(Row, {\n    justify: \"space-between\"\n  }, __jsx(Title, null, \"Current Office Hours\"), role === Role.TA && __jsx(TACheckinButton, {\n    courseId: Number(cid),\n    room: \"Online\",\n    state: queueCheckedIn ? \"CheckedIn\" : \"CheckedOut\"\n  })), role === Role.PROFESSOR && __jsx(Row, null, __jsx(\"div\", null, \"You are a professor for this course\")), (course === null || course === void 0 ? void 0 : (_course$queues = course.queues) === null || _course$queues === void 0 ? void 0 : _course$queues.length) === 0 ? __jsx(\"h1\", {\n    style: {\n      paddingTop: \"100px\"\n    }\n  }, \"There are currently no scheduled office hours\") : course === null || course === void 0 ? void 0 : (_course$queues2 = course.queues) === null || _course$queues2 === void 0 ? void 0 : _course$queues2.map(function (q) {\n    return __jsx(OpenQueueCard, {\n      key: q.id,\n      queue: q,\n      isTA: role === Role.TA,\n      updateQueueNotes: updateQueueNotes\n    });\n  }), !course && __jsx(OpenQueueCardSkeleton, null), course && course.heatmap && __jsx(PopularTimes, {\n    heatmap: collapseHeatmap(arrayRotate(course.heatmap, -Math.floor(moment().utcOffset() / 15)))\n  })), __jsx(Col, {\n    md: 12,\n    sm: 24\n  }, __jsx(SchedulePanel, {\n    courseId: Number(cid),\n    defaultView: \"day\"\n  })))));\n}","map":{"version":3,"sources":["/home/runner/work/office-hours/office-hours/packages/app/pages/course/[cid]/today.tsx"],"names":["API","Role","Col","Row","chunk","mean","moment","Head","useRouter","React","styled","StandardPageContainer","NavBar","SchedulePanel","OpenQueueCard","OpenQueueCardSkeleton","PopularTimes","ReleaseNotes","TACheckinButton","WelcomeStudents","useCourse","useProfile","useRoleInCourse","Container","div","Title","arrayRotate","arr","count","adjustedCount","length","slice","concat","collapseHeatmap","heatmap","map","hours","filteredOfficeHours","filter","v","Today","router","cid","query","profile","role","Number","course","mutateCourse","updateQueueNotes","queue","notes","newQueues","queues","q","id","update","allowQuestions","queueCheckedIn","find","staffList","staff","name","TA","PROFESSOR","paddingTop","Math","floor","utcOffset"],"mappings":"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","sourcesContent":["import { API } from \"@koh/api-client\";\nimport { Heatmap, QueuePartial, Role } from \"@koh/common\";\nimport { Col, Row } from \"antd\";\nimport { chunk, mean } from \"lodash\";\nimport moment from \"moment\";\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\nimport React, { ReactElement } from \"react\";\nimport styled from \"styled-components\";\nimport { StandardPageContainer } from \"../../../components/common/PageContainer\";\nimport NavBar from \"../../../components/Nav/NavBar\";\nimport SchedulePanel from \"../../../components/Schedule/SchedulePanel\";\nimport OpenQueueCard, {\n  OpenQueueCardSkeleton,\n} from \"../../../components/Today/OpenQueueCard\";\nimport PopularTimes from \"../../../components/Today/PopularTimes/PopularTimes\";\nimport ReleaseNotes from \"../../../components/Today/ReleaseNotes\";\nimport TACheckinButton from \"../../../components/Today/TACheckinButton\";\nimport WelcomeStudents from \"../../../components/Today/WelcomeStudents\";\nimport { useCourse } from \"../../../hooks/useCourse\";\nimport { useProfile } from \"../../../hooks/useProfile\";\nimport { useRoleInCourse } from \"../../../hooks/useRoleInCourse\";\n\nconst Container = styled.div`\n  margin-top: 32px;\n`;\n\nconst Title = styled.div`\n  font-weight: 500;\n  font-size: 30px;\n  color: #212934;\n`;\n\nfunction arrayRotate(arr, count) {\n  const adjustedCount = (arr.length + count) % arr.length;\n  return arr\n    .slice(adjustedCount, arr.length)\n    .concat(arr.slice(0, adjustedCount));\n}\n\nconst collapseHeatmap = (heatmap: Heatmap): Heatmap =>\n  chunk(heatmap, 4).map((hours) => {\n    const filteredOfficeHours = hours.filter((v) => v !== -1);\n    return filteredOfficeHours.length > 0 ? mean(filteredOfficeHours) : -1;\n  });\n\nexport default function Today(): ReactElement {\n  const router = useRouter();\n  const { cid } = router.query;\n  const profile = useProfile();\n  const role = useRoleInCourse(Number(cid));\n\n  const { course, mutateCourse } = useCourse(Number(cid));\n\n  const updateQueueNotes = async (\n    queue: QueuePartial,\n    notes: string\n  ): Promise<void> => {\n    const newQueues =\n      course &&\n      course.queues.map((q) => (q.id === queue.id ? { ...q, notes } : q));\n\n    mutateCourse({ ...course, queues: newQueues }, false);\n    await API.queues.update(queue.id, {\n      notes,\n      allowQuestions: queue.allowQuestions,\n    });\n    mutateCourse();\n  };\n\n  const queueCheckedIn = course?.queues.find((queue) =>\n    queue.staffList.find((staff) => staff.id === profile.id)\n  );\n\n  return (\n    <StandardPageContainer>\n      <Head>\n        <title>{course?.name} | Khoury Office Hours</title>\n      </Head>\n      <ReleaseNotes />\n      <WelcomeStudents />\n      <NavBar courseId={Number(cid)} />\n      <Container>\n        <Row gutter={64}>\n          <Col md={12} xs={24}>\n            <Row justify=\"space-between\">\n              <Title>Current Office Hours</Title>\n              {role === Role.TA && (\n                <TACheckinButton\n                  courseId={Number(cid)}\n                  room=\"Online\"\n                  state={queueCheckedIn ? \"CheckedIn\" : \"CheckedOut\"}\n                />\n              )}\n            </Row>\n            {role === Role.PROFESSOR && (\n              <Row>\n                <div>You are a professor for this course</div>\n              </Row>\n            )}\n            {course?.queues?.length === 0 ? (\n              <h1 style={{ paddingTop: \"100px\" }}>\n                There are currently no scheduled office hours\n              </h1>\n            ) : (\n              course?.queues?.map((q) => (\n                <OpenQueueCard\n                  key={q.id}\n                  queue={q}\n                  isTA={role === Role.TA}\n                  updateQueueNotes={updateQueueNotes}\n                />\n              ))\n            )}\n            {!course && <OpenQueueCardSkeleton />}\n            {/*This only works with UTC offsets in the form N:00, to help with other offsets, the size of the array might have to change to a size of 24*7*4 (for every 15 min interval) */}\n            {course && course.heatmap && (\n              <PopularTimes\n                heatmap={collapseHeatmap(\n                  arrayRotate(\n                    course.heatmap,\n                    -Math.floor(moment().utcOffset() / 15)\n                  )\n                )}\n              />\n            )}\n          </Col>\n          <Col md={12} sm={24}>\n            <SchedulePanel courseId={Number(cid)} defaultView=\"day\" />\n          </Col>\n        </Row>\n      </Container>\n    </StandardPageContainer>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}