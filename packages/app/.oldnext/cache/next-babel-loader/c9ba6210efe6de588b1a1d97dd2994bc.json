{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { API } from \"@koh/api-client\";\nimport { GetQueueResponse } from \"@koh/common\";\nimport useSWR from \"swr\";\nimport { useCallback } from \"react\";\nimport { useEventSource } from \"./useEventSource\";\nimport { plainToClass } from \"class-transformer\";\nexport function useQueue(qid) {\n  var _useSWR = useSWR(qid && \"/api/v1/queues/\".concat(qid), /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", API.queues.get(Number(qid)));\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }))),\n      queue = _useSWR.data,\n      queueError = _useSWR.error,\n      mutateQueue = _useSWR.mutate;\n\n  var isQueueLive = useEventSource(qid && \"/api/v1/queues/\".concat(qid, \"/sse\"), \"queue\", useCallback(function (data) {\n    if (data.queue) {\n      mutateQueue(plainToClass(GetQueueResponse, data.queue), false);\n    }\n  }, [mutateQueue]));\n  return {\n    queue: queue,\n    queueError: queueError,\n    mutateQueue: mutateQueue,\n    isQueueLive: isQueueLive\n  };\n}","map":{"version":3,"sources":["/home/runner/work/office-hours/office-hours/packages/app/hooks/useQueue.ts"],"names":["API","GetQueueResponse","useSWR","useCallback","useEventSource","plainToClass","useQueue","qid","queues","get","Number","queue","data","queueError","error","mutateQueue","mutate","isQueueLive"],"mappings":";;AAAA,SAASA,GAAT,QAAoB,iBAApB;AACA,SAASC,gBAAT,QAAiE,aAAjE;AACA,OAAOC,MAAP,MAA0C,KAA1C;AACA,SAASC,WAAT,QAA4B,OAA5B;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,YAAT,QAA6B,mBAA7B;AAWA,OAAO,SAASC,QAAT,CAAkBC,GAAlB,EAA+C;AAAA,gBACYL,MAAM,CACpEK,GAAG,6BAAsBA,GAAtB,CADiE,wEAEpE;AAAA;AAAA;AAAA;AAAA;AAAA,6CAAYP,GAAG,CAACQ,MAAJ,CAAWC,GAAX,CAAeC,MAAM,CAACH,GAAD,CAArB,CAAZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAFoE,GADlB;AAAA,MACtCI,KADsC,WAC5CC,IAD4C;AAAA,MACxBC,UADwB,WAC/BC,KAD+B;AAAA,MACJC,WADI,WACZC,MADY;;AAMpD,MAAMC,WAAW,GAAGb,cAAc,CAChCG,GAAG,6BAAsBA,GAAtB,SAD6B,EAEhC,OAFgC,EAGhCJ,WAAW,CACT,UAACS,IAAD,EAA4B;AAC1B,QAAIA,IAAI,CAACD,KAAT,EAAgB;AACdI,MAAAA,WAAW,CAACV,YAAY,CAACJ,gBAAD,EAAmBW,IAAI,CAACD,KAAxB,CAAb,EAA6C,KAA7C,CAAX;AACD;AACF,GALQ,EAMT,CAACI,WAAD,CANS,CAHqB,CAAlC;AAaA,SAAO;AACLJ,IAAAA,KAAK,EAALA,KADK;AAELE,IAAAA,UAAU,EAAVA,UAFK;AAGLE,IAAAA,WAAW,EAAXA,WAHK;AAILE,IAAAA,WAAW,EAAXA;AAJK,GAAP;AAMD","sourcesContent":["import { API } from \"@koh/api-client\";\nimport { GetQueueResponse, QueuePartial, SSEQueueResponse } from \"@koh/common\";\nimport useSWR, { responseInterface } from \"swr\";\nimport { useCallback } from \"react\";\nimport { useEventSource } from \"./useEventSource\";\nimport { plainToClass } from \"class-transformer\";\n\ntype queueResponse = responseInterface<QueuePartial, any>;\n\ninterface UseQueueReturn {\n  queue?: queueResponse[\"data\"];\n  queueError: queueResponse[\"error\"];\n  mutateQueue: queueResponse[\"mutate\"];\n  isQueueLive: boolean;\n}\n\nexport function useQueue(qid: number): UseQueueReturn {\n  const { data: queue, error: queueError, mutate: mutateQueue } = useSWR(\n    qid && `/api/v1/queues/${qid}`,\n    async () => API.queues.get(Number(qid))\n  );\n\n  const isQueueLive = useEventSource(\n    qid && `/api/v1/queues/${qid}/sse`,\n    \"queue\",\n    useCallback(\n      (data: SSEQueueResponse) => {\n        if (data.queue) {\n          mutateQueue(plainToClass(GetQueueResponse, data.queue), false);\n        }\n      },\n      [mutateQueue]\n    )\n  );\n\n  return {\n    queue,\n    queueError,\n    mutateQueue,\n    isQueueLive,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}