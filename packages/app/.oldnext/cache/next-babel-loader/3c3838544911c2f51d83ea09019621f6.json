{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { API } from \"@koh/api-client\";\nimport { ListQuestionsResponse } from \"@koh/common\";\nimport { plainToClass } from \"class-transformer\";\nimport { useCallback } from \"react\";\nimport useSWR from \"swr\";\nimport { useEventSource } from \"./useEventSource\";\nexport function useQuestions(qid) {\n  var _useSWR = useSWR(qid && \"/api/v1/queues/\".concat(qid, \"/questions\"), /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", API.questions.index(Number(qid)));\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }))),\n      questions = _useSWR.data,\n      questionsError = _useSWR.error,\n      mutateQuestions = _useSWR.mutate; // Subscribe to sse\n\n\n  useEventSource(qid && \"/api/v1/queues/\".concat(qid, \"/sse\"), \"question\", useCallback(function (data) {\n    if (data.questions) {\n      mutateQuestions(plainToClass(ListQuestionsResponse, data.questions), false);\n    }\n  }, [mutateQuestions]));\n  return {\n    questions: questions,\n    questionsError: questionsError,\n    mutateQuestions: mutateQuestions\n  };\n}","map":{"version":3,"sources":["/home/runner/work/office-hours/office-hours/packages/app/hooks/useQuestions.ts"],"names":["API","ListQuestionsResponse","plainToClass","useCallback","useSWR","useEventSource","useQuestions","qid","questions","index","Number","data","questionsError","error","mutateQuestions","mutate"],"mappings":";;AAAA,SAASA,GAAT,QAAoB,iBAApB;AACA,SAASC,qBAAT,QAAwD,aAAxD;AACA,SAASC,YAAT,QAA6B,mBAA7B;AACA,SAASC,WAAT,QAA4B,OAA5B;AACA,OAAOC,MAAP,MAA0C,KAA1C;AACA,SAASC,cAAT,QAA+B,kBAA/B;AAUA,OAAO,SAASC,YAAT,CAAsBC,GAAtB,EAAsD;AAAA,gBAKvDH,MAAM,CAACG,GAAG,6BAAsBA,GAAtB,eAAJ,wEAA2C;AAAA;AAAA;AAAA;AAAA;AAAA,6CACnDP,GAAG,CAACQ,SAAJ,CAAcC,KAAd,CAAoBC,MAAM,CAACH,GAAD,CAA1B,CADmD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA3C,GALiD;AAAA,MAEnDC,SAFmD,WAEzDG,IAFyD;AAAA,MAGlDC,cAHkD,WAGzDC,KAHyD;AAAA,MAIjDC,eAJiD,WAIzDC,MAJyD,EAS3D;;;AACAV,EAAAA,cAAc,CACZE,GAAG,6BAAsBA,GAAtB,SADS,EAEZ,UAFY,EAGZJ,WAAW,CACT,UAACQ,IAAD,EAA4B;AAC1B,QAAIA,IAAI,CAACH,SAAT,EAAoB;AAClBM,MAAAA,eAAe,CACbZ,YAAY,CAACD,qBAAD,EAAwBU,IAAI,CAACH,SAA7B,CADC,EAEb,KAFa,CAAf;AAID;AACF,GARQ,EAST,CAACM,eAAD,CATS,CAHC,CAAd;AAgBA,SAAO;AAAEN,IAAAA,SAAS,EAATA,SAAF;AAAaI,IAAAA,cAAc,EAAdA,cAAb;AAA6BE,IAAAA,eAAe,EAAfA;AAA7B,GAAP;AACD","sourcesContent":["import { API } from \"@koh/api-client\";\nimport { ListQuestionsResponse, SSEQueueResponse } from \"@koh/common\";\nimport { plainToClass } from \"class-transformer\";\nimport { useCallback } from \"react\";\nimport useSWR, { responseInterface } from \"swr\";\nimport { useEventSource } from \"./useEventSource\";\n\ntype questionsResponse = responseInterface<ListQuestionsResponse, any>;\n\ninterface UseQuestionReturn {\n  questions?: questionsResponse[\"data\"];\n  questionsError: questionsResponse[\"error\"];\n  mutateQuestions: questionsResponse[\"mutate\"];\n}\n\nexport function useQuestions(qid: number): UseQuestionReturn {\n  const {\n    data: questions,\n    error: questionsError,\n    mutate: mutateQuestions,\n  } = useSWR(qid && `/api/v1/queues/${qid}/questions`, async () =>\n    API.questions.index(Number(qid))\n  );\n\n  // Subscribe to sse\n  useEventSource(\n    qid && `/api/v1/queues/${qid}/sse`,\n    \"question\",\n    useCallback(\n      (data: SSEQueueResponse) => {\n        if (data.questions) {\n          mutateQuestions(\n            plainToClass(ListQuestionsResponse, data.questions),\n            false\n          );\n        }\n      },\n      [mutateQuestions]\n    )\n  );\n\n  return { questions, questionsError, mutateQuestions };\n}\n"]},"metadata":{},"sourceType":"module"}