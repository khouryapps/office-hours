{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { API } from \"@koh/api-client\";\nimport { ListQuestionsResponse } from \"@koh/common\";\nimport { plainToClass } from \"class-transformer\";\nimport { useCallback } from \"react\";\nimport useSWR, { mutate } from \"swr\";\nimport { useEventSource } from \"./useEventSource\";\nexport function useQuestions(qid) {\n  var key = qid && \"/api/v1/queues/\".concat(qid, \"/questions\"); // Subscribe to sse\n\n  var isLive = useEventSource(qid && \"/api/v1/queues/\".concat(qid, \"/sse\"), \"question\", useCallback(function (data) {\n    if (data.questions) {\n      mutate(key, plainToClass(ListQuestionsResponse, data.questions), false);\n    }\n  }, [key]));\n\n  var _useSWR = useSWR(key, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", API.questions.index(Number(qid)));\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })), {\n    refreshInterval: isLive ? 0 : 10 * 1000\n  }),\n      questions = _useSWR.data,\n      questionsError = _useSWR.error,\n      mutateQuestions = _useSWR.mutate;\n\n  return {\n    questions: questions,\n    questionsError: questionsError,\n    mutateQuestions: mutateQuestions\n  };\n}","map":{"version":3,"sources":["/home/runner/work/office-hours/office-hours/packages/app/hooks/useQuestions.ts"],"names":["API","ListQuestionsResponse","plainToClass","useCallback","useSWR","mutate","useEventSource","useQuestions","qid","key","isLive","data","questions","index","Number","refreshInterval","questionsError","error","mutateQuestions"],"mappings":";;AAAA,SAASA,GAAT,QAAoB,iBAApB;AACA,SAASC,qBAAT,QAAwD,aAAxD;AACA,SAASC,YAAT,QAA6B,mBAA7B;AACA,SAASC,WAAT,QAA4B,OAA5B;AACA,OAAOC,MAAP,IAAiBC,MAAjB,QAAkD,KAAlD;AACA,SAASC,cAAT,QAA+B,kBAA/B;AAUA,OAAO,SAASC,YAAT,CAAsBC,GAAtB,EAAsD;AAC3D,MAAMC,GAAG,GAAGD,GAAG,6BAAsBA,GAAtB,eAAf,CAD2D,CAE3D;;AACA,MAAME,MAAM,GAAGJ,cAAc,CAC3BE,GAAG,6BAAsBA,GAAtB,SADwB,EAE3B,UAF2B,EAG3BL,WAAW,CACT,UAACQ,IAAD,EAA4B;AAC1B,QAAIA,IAAI,CAACC,SAAT,EAAoB;AAClBP,MAAAA,MAAM,CACJI,GADI,EAEJP,YAAY,CAACD,qBAAD,EAAwBU,IAAI,CAACC,SAA7B,CAFR,EAGJ,KAHI,CAAN;AAKD;AACF,GATQ,EAUT,CAACH,GAAD,CAVS,CAHgB,CAA7B;;AAH2D,gBAwBvDL,MAAM,CAACK,GAAD,wEAAM;AAAA;AAAA;AAAA;AAAA;AAAA,6CAAYT,GAAG,CAACY,SAAJ,CAAcC,KAAd,CAAoBC,MAAM,CAACN,GAAD,CAA1B,CAAZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAN,IAAoD;AAC5DO,IAAAA,eAAe,EAAEL,MAAM,GAAG,CAAH,GAAO,KAAK;AADyB,GAApD,CAxBiD;AAAA,MAqBnDE,SArBmD,WAqBzDD,IArByD;AAAA,MAsBlDK,cAtBkD,WAsBzDC,KAtByD;AAAA,MAuBjDC,eAvBiD,WAuBzDb,MAvByD;;AA4B3D,SAAO;AAAEO,IAAAA,SAAS,EAATA,SAAF;AAAaI,IAAAA,cAAc,EAAdA,cAAb;AAA6BE,IAAAA,eAAe,EAAfA;AAA7B,GAAP;AACD","sourcesContent":["import { API } from \"@koh/api-client\";\nimport { ListQuestionsResponse, SSEQueueResponse } from \"@koh/common\";\nimport { plainToClass } from \"class-transformer\";\nimport { useCallback } from \"react\";\nimport useSWR, { mutate, responseInterface } from \"swr\";\nimport { useEventSource } from \"./useEventSource\";\n\ntype questionsResponse = responseInterface<ListQuestionsResponse, any>;\n\ninterface UseQuestionReturn {\n  questions?: questionsResponse[\"data\"];\n  questionsError: questionsResponse[\"error\"];\n  mutateQuestions: questionsResponse[\"mutate\"];\n}\n\nexport function useQuestions(qid: number): UseQuestionReturn {\n  const key = qid && `/api/v1/queues/${qid}/questions`;\n  // Subscribe to sse\n  const isLive = useEventSource(\n    qid && `/api/v1/queues/${qid}/sse`,\n    \"question\",\n    useCallback(\n      (data: SSEQueueResponse) => {\n        if (data.questions) {\n          mutate(\n            key,\n            plainToClass(ListQuestionsResponse, data.questions),\n            false\n          );\n        }\n      },\n      [key]\n    )\n  );\n\n  const {\n    data: questions,\n    error: questionsError,\n    mutate: mutateQuestions,\n  } = useSWR(key, async () => API.questions.index(Number(qid)), {\n    refreshInterval: isLive ? 0 : 10 * 1000,\n  });\n\n  return { questions, questionsError, mutateQuestions };\n}\n"]},"metadata":{},"sourceType":"module"}