{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/var/www/source/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/var/www/source/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport useSWR from \"swr\";\nimport React from \"react\";\nimport { API } from \"@koh/api-client\";\nimport { Button, message, Modal, Table } from \"antd\";\nimport { ExclamationCircleOutlined } from \"@ant-design/icons\";\nimport Router from \"next/router\";\nimport { HeaderTitle } from \"./Styled\";\nimport { useCourse } from \"../../hooks/useCourse\";\nvar confirm = Modal.confirm;\nexport default function CoursePreferenceSettings() {\n  var _useSWR = useSWR(\"api/v1/profile\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", API.profile.index());\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }))),\n      profile = _useSWR.data,\n      mutate = _useSWR.mutate;\n\n  var formattedRoles = {\n    student: \"Student\",\n    ta: \"TA\",\n    professor: \"Professor\"\n  };\n\n  function withdraw(_x) {\n    return _withdraw.apply(this, arguments);\n  }\n\n  function _withdraw() {\n    _withdraw = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(course) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return API.course.withdrawCourse(course.course.id);\n\n            case 2:\n              message.success(\"Successfully withdrew from \" + course.course.name);\n              _context2.next = 5;\n              return mutate();\n\n            case 5:\n              _context2.next = 7;\n              return Router.push(\"/\");\n\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _withdraw.apply(this, arguments);\n  }\n\n  function showConfirm(courseId) {\n    var course = profile === null || profile === void 0 ? void 0 : profile.courses.find(function (c) {\n      return c.course.id === courseId;\n    });\n    confirm({\n      title: \"Please Confirm!\",\n      icon: /*#__PURE__*/_jsx(ExclamationCircleOutlined, {}),\n      content: \"Please confirm that you want to unenroll from \".concat(course.course.name, \" as a \").concat(formattedRoles[course.role], \".  The only way to get back is by contacting a professor!\"),\n      onOk: function onOk() {\n        withdraw(course);\n      }\n    });\n  }\n\n  var InstructorCell = function InstructorCell(_ref2) {\n    var _course$course;\n\n    var courseId = _ref2.courseId;\n    var course = useCourse(courseId);\n    return /*#__PURE__*/_jsx(_Fragment, {\n      children: (_course$course = course.course) === null || _course$course === void 0 ? void 0 : _course$course.coordinator_email\n    });\n  };\n\n  var columns = [{\n    title: \"Course name\",\n    dataIndex: \"name\",\n    key: \"name\"\n  }, {\n    title: \"Role\",\n    dataIndex: \"role\",\n    key: \"role\"\n  }, {\n    title: \"Instructor\",\n    dataIndex: \"instructor\",\n    key: \"instructor\",\n    render: function createInstructorCell(courseId) {\n      return /*#__PURE__*/_jsx(InstructorCell, {\n        courseId: courseId\n      });\n    }\n  }, {\n    title: \"\",\n    key: \"courseId\",\n    dataIndex: \"courseId\",\n    render: function withdrawButton(courseId) {\n      return /*#__PURE__*/_jsx(Button, {\n        style: {\n          marginLeft: \"20px\"\n        },\n        type: \"primary\",\n        shape: \"round\",\n        onClick: function onClick() {\n          showConfirm(courseId);\n        },\n        danger: true,\n        children: \"Withdraw\"\n      });\n    }\n  }];\n\n  function createCourseDataSource() {\n    return profile === null || profile === void 0 ? void 0 : profile.courses.map(function (c) {\n      return {\n        key: c.course.id,\n        name: c.course.name,\n        role: formattedRoles[c.role],\n        instructor: c.course.id,\n        courseId: c.course.id\n      };\n    });\n  }\n\n  return profile && /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(HeaderTitle, {\n      children: /*#__PURE__*/_jsx(\"h1\", {\n        children: \"Course Preferences\"\n      })\n    }), /*#__PURE__*/_jsx(Table, {\n      columns: columns,\n      dataSource: createCourseDataSource()\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}