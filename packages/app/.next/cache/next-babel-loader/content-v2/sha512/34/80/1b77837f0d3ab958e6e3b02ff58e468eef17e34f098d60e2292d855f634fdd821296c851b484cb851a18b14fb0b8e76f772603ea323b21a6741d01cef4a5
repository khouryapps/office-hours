{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/var/www/source/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/var/www/source/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { BellOutlined, BookOutlined, DeleteOutlined, UploadOutlined, UserOutlined, WindowsOutlined } from \"@ant-design/icons\";\nimport { Collapse } from \"antd\";\nimport { API } from \"@koh/api-client\";\nimport { Role } from \"@koh/common\";\nimport { useWindowWidth } from \"@react-hook/window-size\";\nimport { Button, Col, Menu, message, Row, Skeleton, Space, Upload } from \"antd\";\nimport React, { useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport useSWR from \"swr\";\nimport NotificationsSettings from \"./NotificationsSettings\";\nimport ProfileSettings from \"./ProfileSettings\";\nimport TeamsSettings from \"./TeamsSettings\";\nimport CoursePreferenceSettings from \"./CoursePreferenceSettings\";\nimport { useIsMobile } from \"../../hooks/useIsMobile\";\nimport { SettingsPanelAvatar } from \"./SettingsSharedComponents\";\nimport { useRoleInCourse } from \"../../hooks/useRoleInCourse\";\nimport { useRouter } from \"next/router\";\nexport var SettingsOptions;\n\n(function (SettingsOptions) {\n  SettingsOptions[\"PROFILE\"] = \"PROFILE\";\n  SettingsOptions[\"NOTIFICATIONS\"] = \"NOTIFICATIONS\";\n  SettingsOptions[\"TEAMS_SETTINGS\"] = \"TEAMS_SETTINGS\";\n  SettingsOptions[\"PREFERENCES\"] = \"PREFERENCES\";\n})(SettingsOptions || (SettingsOptions = {}));\n\nexport var VerticalDivider = styled.div.withConfig({\n  displayName: \"SettingsPage__VerticalDivider\",\n  componentId: \"sc-14ibjpn-0\"\n})([\"@media (min-width:767px){border-right:1px solid #cfd6de;margin-right:32px;}\"]);\nvar ProfilePicButton = styled(Button).withConfig({\n  displayName: \"SettingsPage__ProfilePicButton\",\n  componentId: \"sc-14ibjpn-1\"\n})([\"flex:wrap;width:calc(5vw);min-width:180px;\"]);\nvar Panel = Collapse.Panel;\nexport default function SettingsPage(_ref) {\n  var defaultPage = _ref.defaultPage;\n\n  var _useSWR = useSWR(\"api/v1/profile\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            return _context.abrupt(\"return\", API.profile.index());\n\n          case 1:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }))),\n      profile = _useSWR.data,\n      error = _useSWR.error,\n      mutate = _useSWR.mutate;\n\n  var router = useRouter();\n  var cid = router.query.cid;\n  var role = useRoleInCourse(Number(cid));\n  var isTAOrProfessor = role === Role.TA || role === Role.PROFESSOR;\n\n  var _useState = useState(defaultPage || SettingsOptions.PROFILE),\n      currentSettings = _useState[0],\n      setCurrentSettings = _useState[1];\n\n  var _useState2 = useState(false),\n      uploading = _useState2[0],\n      setUploading = _useState2[1];\n\n  var isMobile = useIsMobile();\n  var windowWidth = useWindowWidth();\n\n  var _useState3 = useState(windowWidth / 2),\n      avatarSize = _useState3[0],\n      setAvatarSize = _useState3[1];\n\n  useEffect(function () {\n    var widthDivider = isMobile ? 6 : 10;\n    setAvatarSize(windowWidth / widthDivider);\n  });\n\n  var beforeUpload = function beforeUpload(file) {\n    var isJpgOrPng = file.type === \"image/jpeg\" || file.type === \"image/png\";\n\n    if (!isJpgOrPng) {\n      message.error(\"You can only upload JPGs or PNGs!\");\n    }\n\n    var isLt1M = file.size / 1024 / 1024 < 1;\n\n    if (!isLt1M) {\n      message.error(\"Image must smaller than 1MB!\");\n    }\n\n    return isJpgOrPng && isLt1M;\n  };\n\n  if (error) {\n    message.error(error);\n  }\n\n  var AvatarSettings = function AvatarSettings() {\n    return /*#__PURE__*/_jsx(Col, {\n      children: avatarSize ? /*#__PURE__*/_jsxs(Row, {\n        style: {\n          marginTop: avatarSize / 6,\n          justifyContent: \"\".concat(isMobile ? \"left\" : \"center\")\n        },\n        children: [uploading ? /*#__PURE__*/_jsx(Skeleton.Avatar, {\n          active: true,\n          size: avatarSize,\n          shape: \"circle\",\n          style: {\n            marginTop: avatarSize / 6,\n            marginBottom: avatarSize / 12,\n            marginLeft: avatarSize / 6,\n            marginRight: avatarSize / 6\n          }\n        }) : /*#__PURE__*/_jsx(SettingsPanelAvatar, {\n          avatarSize: avatarSize\n        }), /*#__PURE__*/_jsxs(Col, {\n          children: [profile && /*#__PURE__*/_jsxs(\"h2\", {\n            children: [profile.firstName, \" \", profile.lastName]\n          }), /*#__PURE__*/_jsx(Upload, {\n            action: \"/api/v1/profile/upload_picture\",\n            beforeUpload: beforeUpload,\n            showUploadList: false,\n            onChange: function onChange(info) {\n              setUploading(info.file.status === \"uploading\");\n              mutate();\n            },\n            children: /*#__PURE__*/_jsx(ProfilePicButton, {\n              icon: /*#__PURE__*/_jsx(UploadOutlined, {}),\n              children: \"Edit photo\"\n            })\n          }), (profile === null || profile === void 0 ? void 0 : profile.photoURL) && /*#__PURE__*/_jsx(ProfilePicButton, {\n            icon: /*#__PURE__*/_jsx(DeleteOutlined, {}),\n            style: {\n              marginTop: \"10px\"\n            },\n            onClick: /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n              return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                while (1) {\n                  switch (_context2.prev = _context2.next) {\n                    case 0:\n                      _context2.prev = 0;\n                      _context2.next = 3;\n                      return API.profile.deleteProfilePicture();\n\n                    case 3:\n                      message.success(\"You've successfully deleted your profile picture\");\n                      mutate();\n                      _context2.next = 11;\n                      break;\n\n                    case 7:\n                      _context2.prev = 7;\n                      _context2.t0 = _context2[\"catch\"](0);\n                      message.error(\"There was an error with deleting your profile picture, please contact the Khoury Office Hours team for assistance\");\n                      throw _context2.t0;\n\n                    case 11:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }\n              }, _callee2, null, [[0, 7]]);\n            })),\n            children: \"Delete my Profile Picture\"\n          })]\n        })]\n      }) : null\n    });\n  };\n\n  var SettingsMenu = function SettingsMenu() {\n    return /*#__PURE__*/_jsx(_Fragment, {\n      children: isMobile ? /*#__PURE__*/_jsxs(Collapse, {\n        accordion: true,\n        style: {\n          marginTop: \"10px\"\n        },\n        children: [/*#__PURE__*/_jsx(Panel, {\n          header: \"Personal Information\",\n          children: /*#__PURE__*/_jsx(ProfileSettings, {})\n        }, \"profile\"), isTAOrProfessor && /*#__PURE__*/_jsx(Panel, {\n          header: \"Teams Settings\",\n          children: /*#__PURE__*/_jsx(TeamsSettings, {})\n        }, \"teams_settings\"), /*#__PURE__*/_jsx(Panel, {\n          header: \"Notifications\",\n          children: /*#__PURE__*/_jsx(NotificationsSettings, {})\n        }, \"notifications\"), /*#__PURE__*/_jsx(Panel, {\n          header: \"Course Preferences\",\n          children: /*#__PURE__*/_jsx(CoursePreferenceSettings, {})\n        }, \"preferences\")]\n      }) : /*#__PURE__*/_jsxs(Menu, {\n        style: {\n          background: \"none\",\n          marginTop: \"10px\"\n        },\n        defaultSelectedKeys: [currentSettings],\n        onClick: function onClick(e) {\n          return setCurrentSettings(e.key);\n        },\n        children: [/*#__PURE__*/_jsx(Menu.Item, {\n          icon: /*#__PURE__*/_jsx(UserOutlined, {}),\n          children: \"Personal Information\"\n        }, SettingsOptions.PROFILE), isTAOrProfessor && /*#__PURE__*/_jsx(Menu.Item, {\n          icon: /*#__PURE__*/_jsx(WindowsOutlined, {}),\n          children: \"Teams Settings\"\n        }, SettingsOptions.TEAMS_SETTINGS), /*#__PURE__*/_jsx(Menu.Item, {\n          icon: /*#__PURE__*/_jsx(BellOutlined, {}),\n          children: \"Notifications\"\n        }, SettingsOptions.NOTIFICATIONS), /*#__PURE__*/_jsx(Menu.Item, {\n          icon: /*#__PURE__*/_jsx(BookOutlined, {}),\n          children: \"Course Preferences\"\n        }, SettingsOptions.PREFERENCES)]\n      })\n    });\n  };\n\n  var DesktopSettingsSubpage = function DesktopSettingsSubpage() {\n    return /*#__PURE__*/_jsxs(Col, {\n      children: [currentSettings === SettingsOptions.PROFILE && /*#__PURE__*/_jsx(ProfileSettings, {}), currentSettings === SettingsOptions.NOTIFICATIONS && /*#__PURE__*/_jsx(NotificationsSettings, {}), currentSettings === SettingsOptions.TEAMS_SETTINGS && /*#__PURE__*/_jsx(TeamsSettings, {}), currentSettings === SettingsOptions.PREFERENCES && /*#__PURE__*/_jsx(CoursePreferenceSettings, {})]\n    });\n  };\n\n  return /*#__PURE__*/_jsx(\"div\", {\n    children: isMobile ? /*#__PURE__*/_jsxs(Col, {\n      children: [/*#__PURE__*/_jsx(AvatarSettings, {}), /*#__PURE__*/_jsx(SettingsMenu, {})]\n    }) : /*#__PURE__*/_jsxs(Row, {\n      children: [/*#__PURE__*/_jsxs(Col, {\n        span: 5,\n        style: {\n          textAlign: \"center\"\n        },\n        children: [/*#__PURE__*/_jsx(AvatarSettings, {}), /*#__PURE__*/_jsx(SettingsMenu, {})]\n      }), /*#__PURE__*/_jsx(VerticalDivider, {}), /*#__PURE__*/_jsx(Space, {\n        direction: \"vertical\",\n        size: 40,\n        style: {\n          flexGrow: 1\n        },\n        children: /*#__PURE__*/_jsx(DesktopSettingsSubpage, {})\n      })]\n    })\n  });\n}","map":null,"metadata":{},"sourceType":"module"}