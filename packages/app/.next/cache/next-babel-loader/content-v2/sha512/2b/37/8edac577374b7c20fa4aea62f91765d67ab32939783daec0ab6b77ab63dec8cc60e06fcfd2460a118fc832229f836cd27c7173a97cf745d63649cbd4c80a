{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/var/www/source/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/var/www/source/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { API } from \"@koh/api-client\";\nimport { Role } from \"@koh/common\";\nimport { Button, message } from \"antd\";\nimport { useRouter } from \"next/router\";\nimport React, { useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useCourse } from \"../../hooks/useCourse\";\nimport { useProfile } from \"../../hooks/useProfile\";\nimport { useRoleInCourse } from \"../../hooks/useRoleInCourse\";\nimport QueueCheckInModal from \"./QueueCheckInModal\";\nimport QueueCreateModal from \"./QueueCreateModal\";\nimport TACheckinButton, { CheckinButton } from \"./TACheckinButton\";\nvar CreateQueueButton = styled(Button).withConfig({\n  displayName: \"QueueCheckInButton__CreateQueueButton\",\n  componentId: \"sc-epn23y-0\"\n})([\"color:white;background:#2a9187;&:hover,&:focus{color:white;background:#39aca1;}\"]);\nexport default function TodayPageCheckinButton() {\n  // state for check in modal\n  var _useState = useState(false),\n      checkInModalVisible = _useState[0],\n      setCheckInModalVisible = _useState[1];\n\n  var _useState2 = useState(false),\n      createQueueModalVisible = _useState2[0],\n      setCreateQueueModalVisible = _useState2[1];\n\n  var profile = useProfile();\n  var router = useRouter();\n  var cid = router.query.cid;\n\n  var _useCourse = useCourse(Number(cid)),\n      course = _useCourse.course,\n      mutateCourse = _useCourse.mutateCourse;\n\n  var role = useRoleInCourse(Number(cid));\n  var availableQueues = course === null || course === void 0 ? void 0 : course.queues.filter(function (q) {\n    return role === Role.TA ? !q.isProfessorQueue : true;\n  });\n  var queueCheckedIn = course === null || course === void 0 ? void 0 : course.queues.find(function (queue) {\n    return queue.staffList.find(function (staff) {\n      return staff.id === (profile === null || profile === void 0 ? void 0 : profile.id);\n    });\n  });\n  var numQueues = course === null || course === void 0 ? void 0 : course.queues.length;\n\n  var renderProperModal = function renderProperModal() {\n    numQueues !== 0 ? setCheckInModalVisible(true) : setCreateQueueModalVisible(true);\n  };\n\n  var submitMakeQueue = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(submittedForm) {\n      var queueRequest, redirectID, _err$response, _err$response$data;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return submittedForm.validateFields();\n\n            case 2:\n              queueRequest = _context.sent;\n              _context.prev = 3;\n              _context.next = 6;\n              return API.taStatus.makeQueue(Number(cid), queueRequest.officeHourName, !queueRequest.allowTA, queueRequest.notes);\n\n            case 6:\n              message.success(\"Created a new queue \".concat(queueRequest.officeHourName, \". Checking you in...\"));\n              _context.next = 9;\n              return API.taStatus.checkIn(Number(cid), queueRequest.officeHourName);\n\n            case 9:\n              redirectID = _context.sent;\n              mutateCourse();\n              router.push(\"/course/[cid]/queue/[qid]\", \"/course/\".concat(Number(cid), \"/queue/\").concat(redirectID.id));\n              setCreateQueueModalVisible(false);\n              _context.next = 18;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](3);\n              message.error((_err$response = _context.t0.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 15]]);\n    }));\n\n    return function submitMakeQueue(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var onCreateQueueButtonClick = function onCreateQueueButtonClick() {\n    setCheckInModalVisible(false);\n    setCreateQueueModalVisible(true);\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [checkInModalVisible && /*#__PURE__*/_jsx(QueueCheckInModal, {\n      visible: checkInModalVisible,\n      onSubmit: /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(queueId) {\n          var redirectID, _err$response2, _err$response2$data;\n\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.prev = 0;\n                  _context2.next = 3;\n                  return API.taStatus.checkIn(Number(cid), availableQueues[queueId].room);\n\n                case 3:\n                  redirectID = _context2.sent;\n                  mutateCourse();\n                  router.push(\"/course/[cid]/queue/[qid]\", \"/course/\".concat(Number(cid), \"/queue/\").concat(redirectID.id));\n                  _context2.next = 11;\n                  break;\n\n                case 8:\n                  _context2.prev = 8;\n                  _context2.t0 = _context2[\"catch\"](0);\n                  message.error((_err$response2 = _context2.t0.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message);\n\n                case 11:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, null, [[0, 8]]);\n        }));\n\n        return function (_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }(),\n      onCancel: function onCancel() {\n        return setCheckInModalVisible(false);\n      },\n      button: /*#__PURE__*/_jsx(CreateQueueButton, {\n        onClick: onCreateQueueButtonClick,\n        children: \"+ Create Queue\"\n      }),\n      queues: availableQueues\n    }), createQueueModalVisible && /*#__PURE__*/_jsx(QueueCreateModal, {\n      visible: createQueueModalVisible,\n      onSubmit: submitMakeQueue,\n      onCancel: function onCancel() {\n        return setCreateQueueModalVisible(false);\n      },\n      role: role,\n      lastName: profile === null || profile === void 0 ? void 0 : profile.lastName\n    }), !queueCheckedIn && role !== Role.STUDENT && /*#__PURE__*/_jsx(CheckinButton, {\n      type: \"default\",\n      size: \"large\",\n      \"data-cy\": \"check-in-modal-button\",\n      onClick: function onClick() {\n        return renderProperModal();\n      },\n      children: \"Check In\"\n    }), queueCheckedIn && role !== Role.STUDENT && /*#__PURE__*/_jsx(TACheckinButton, {\n      courseId: Number(cid),\n      room: queueCheckedIn.room,\n      state: \"CheckedIn\"\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}